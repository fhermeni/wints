!function(){function declared(){var ms=[],i=0;stats.forEach(function(s){d=new Date(s.Creation),d.setUTCDate(d.getUTCDate()>15?15:1);d.getMonth();ms.push(d.getYear()-100+"-"+d.getUTCMonth()+"-"+d.getUTCDate())}),ms.sort();var toShift=ms[0].endsWith("-15");if(toShift){var x=ms[0].substring(0,ms[0].length-3)+"-1";ms.unshift(x)}var labels=[],count=[],i=0;for(ms.forEach(function(m){0==labels.length?(labels.push(m),count[i++]=1):labels[i-1]==m?count[i-1]++:(labels[i]=m,count[i]=count[i-1]+1,i++)}),toShift&&count.unshift(0),i=0;i<count.length;i++)count[i]=Math.round(count[i]/stats.length*100);var xx=[];labels.forEach(function(l){var buf=l.split("-");xx.push(months[buf[1]]+" "+buf[0])});{var atLab=$("#conventions").get(0).getContext("2d"),data={labels:ddply(xx),datasets:[line(count)]};new Chart(atLab).Line(data,{pointDotRadius:2,tooltipTemplate:"<%= value %>",scaleOverride:!0,scaleSteps:6,scaleStepWidth:20})}}function ddply(arr){for(var res=[arr[0]],i=1;i<arr.length;i++)res[i]=arr[i]==arr[i-1]?"":arr[i];return res}function durations(){var begin=new Date;begin.setMonth(1),begin.setDate(1);var end=new Date;end.setMonth(10),end.setDate(31);for(var labels=[],cur=new Date(begin.getTime()),ins=[];cur.getTime()<end.getTime();)labels.push(months[cur.getMonth()]),cur.setMonth(cur.getMonth()+1),ins.push(0);stats.forEach(function(s){for(var i=0,cur=new Date(begin.getTime());cur.getTime()<end.getTime();)s.Begin.getTime()<=cur.getTime()&&s.End.getTime()>=cur.getTime()&&ins[i]++,cur.setMonth(cur.getMonth()+1),i++});{var atLab=$("#periods").get(0).getContext("2d"),data={labels:ddply(labels),datasets:[line(ins)]};new Chart(atLab).Line(data,{pointDotRadius:2,tooltipTemplate:"<%= value %>",scaleOverride:!0,scaleSteps:6,scaleStepWidth:20})}}function gratification(filter){$("li.gratification").removeClass("active"),filter?$("li.gratification."+filter).addClass("active"):$("li.gratification.all").addClass("active");for(var byMajor=[],qty=[[],[]],i=0;i<allMajors.length;i++)byMajor.push([]);var all=0;if(stats.forEach(function(s){all+=s.Gratification,"promotion"==filter?qty["SI"==s.Promotion?0:1].push(s.Gratification):"sector"==filter?qty[s.Lab?0:1].push(s.Gratification):"country"==filter?qty[s.ForeignCountry?0:1].push(s.Gratification):"major"==filter&&byMajor[allMajors.indexOf(s.Major)].push(s.Gratification)}),filter)if("major"==filter){for(var avgs=[],i=0;i<byMajor.length;i++)avgs.push(Math.round(avg(byMajor[i])));c=$("<canvas>"),data={labels:allMajors,datasets:[{label:"Gratification",fillColor:"#F7464A",highlightFill:"#FF5A5E",data:avgs}]},c=$("#how-much").html("").append(c).find("canvas"),ctx=c.get(0).getContext("2d"),grat=new Chart(ctx).Bar(data)}else $("#how-much").html(Math.round(avg(qty[0]))+"€ vs. "+Math.round(avg(qty[1]))+"€");else $("#how-much").html(Math.round(all/stats.length)+"€")}function grades(kind,filter){$("li.grades-"+kind).removeClass("active"),filter?$("li.grades-"+kind+"."+filter).addClass("active"):$("li.grades-"+kind+".all").addClass("active");for(var byMajor=[],qty=[[],[]],i=0;i<allMajors.length;i++)byMajor.push([]);var all=0,nb=0;if(stats.forEach(function(s){s.Reports[kind]&&s.Reports[kind]>=0&&(g=s.Reports[kind],nb++,all+=g,"promotion"==filter?qty["SI"==s.Promotion?0:1].push(g):"major"==filter&&byMajor[allMajors.indexOf(s.Major)].push(g))}),nb&&$("#grades-"+kind).closest(".hidden").removeClass("hidden"),filter)if("major"==filter){for(var avgs=[],i=0;i<byMajor.length;i++)avgs.push(avg(byMajor[i]).toFixed(2));c=$("<canvas>"),data={labels:allMajors,datasets:[{label:"Gratification",fillColor:"#F7464A",highlightFill:"#FF5A5E",data:avgs}]},c=$("#grades-"+kind).html("").append(c).find("canvas"),ctx=c.get(0).getContext("2d"),grat=new Chart(ctx).Bar(data)}else avgs=[avg(qty[0]).toFixed(2),avg(qty[1]).toFixed(2)],c=$("<canvas>"),data={labels:["SI","master"],datasets:[{label:"Gratification",fillColor:"#F7464A",highlightFill:"#FF5A5E",data:avgs}]},c=$("#grades-"+kind).html("").append(c).find("canvas"),ctx=c.get(0).getContext("2d"),grat=new Chart(ctx).Bar(data);else num=all/nb,$("#grades-"+kind).html(num.toFixed(2)+" / 20")}function surveys(kind){var all=0,nb=0;if(stats.forEach(function(s){q=s.Surveys[kind],q&&Object.keys(q).length>0&&(nb++,"midterm"==kind&&"true"==q[19]&&all++)}),nb){var num=Math.round(all/nb);$("#surveys-"+kind).html(num+" %"),$("#surveys-"+kind).closest(".hidden").removeClass("hidden")}}function avg(values){var sum=0,nb=0;return 0==values.length?nb:(values.forEach(function(v){sum+=v,nb++}),sum/nb)}function employers(){var c2={};stats.forEach(function(s){s.Cpy.WWW?c2[s.Cpy.WWW]="<a href='"+s.Cpy.WWW+"'>"+s.Cpy.Name+"</a>":c2[s.Cpy.Name]=s.Cpy.Name});var c3=[];Object.keys(c2).forEach(function(k){c3.push(c2[k])}),$("#employers").html(c3.join("; "))}function country(filter){if(filter||(filter="all"),$("li.filter.country").removeClass("active"),$("li.filter.country."+filter).addClass("active"),qty=[0,0],byMajor=[zeroes(allMajors.length),zeroes(allMajors.length)],stats.forEach(function(s){("all"==filter||s.Promotion==filter)&&(qty[s.ForeignCountry?1:0]+=1,byMajor[s.ForeignCountry?1:0][allMajors.indexOf(s.Major)]+=1)}),$("li.country.byMajor").hasClass("active"))if(ccountry){for(var i=0;i<allMajors.length;i++)ccountry.datasets[0].bars[i].value=byMajor[0][i],ccountry.datasets[1].bars[i].value=byMajor[1][i];ccountry.update()}else{data={labels:allMajors,datasets:[{label:"France",fillColor:"#F7464A",highlightFill:"#FF5A5E",data:byMajor[0]},{label:"Foreign Country",fillColor:"#FFC870",highlightFill:"#FFC870",data:byMajor[1]}]};var g=$("#country").find("canvas").get(0).getContext("2d");ccountry=new Chart(g).Bar(data)}else if(ccountry)ccountry.segments[0].value=qty[0],ccountry.segments[1].value=qty[1],ccountry.update();else{var g=$("#country").find("canvas").get(0).getContext("2d");data=[{value:qty[0],label:"France",color:"#F7464A",highlight:"#FF5A5E"},{value:qty[1],label:"Foreign Country",color:"#FDB45C",highlight:"#FFC870"}],ccountry=new Chart(g).Pie(data)}}function sector(filter){if(filter||(filter="all"),$("li.sector.filter").removeClass("active"),$("li.sector.filter."+filter).addClass("active"),qty=[0,0],byMajor=[zeroes(allMajors.length),zeroes(allMajors.length)],stats.forEach(function(s){("all"==filter||s.Promotion==filter)&&(qty[s.Lab?1:0]+=1,byMajor[s.Lab?1:0][allMajors.indexOf(s.Major)]+=1)}),$("li.sector.byMajor").hasClass("active"))if(csector){for(var i=0;i<allMajors.length;i++)csector.datasets[0].bars[i].value=byMajor[0][i],csector.datasets[1].bars[i].value=byMajor[1][i];csector.update()}else data={labels:allMajors,datasets:[{label:"Company",fillColor:"#949FB1",highlightFill:"#A8B3C5",data:byMajor[0]},{label:"Lab",fillColor:"#4D5360",highlightFill:"#616774",data:byMajor[1]}]},csector=new Chart($("#sector").find("canvas").get(0).getContext("2d")).Bar(data);else if(csector)csector.segments[0].value=qty[0],csector.segments[1].value=qty[1],csector.update();else{var data=[{value:qty[0],label:"Company",color:"#949FB1",highlight:"#A8B3C5"},{value:qty[1],label:"Lab",color:"#4D5360",highlight:"#616774"}];csector=new Chart($("#sector").find("canvas").get(0).getContext("2d")).Pie(data)}}function zeroes(nb){for(var x=[],i=0;nb>i;i++)x.push(0);return x}function line(dta){return{label:"Pick up date",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:dta}}var stats,allMajors,months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],ccountry=void 0,csector=void 0;$(document).ready(function(){waitingBlock=$("#cnt").clone().html(),statistics(function(m){stats=m,majors(function(m){allMajors=m,allMajors.push("n/a");for(var i=0;i<stats.length;i++)""!=stats[i].Major&&stats[i].Major||(stats[i].Major="n/a"),stats[i].Promotion=stats[i].Promotion.indexOf("si")>=0?"SI":"master",stats[i].Gratification>1e4&&(stats[i].Gratification/=100),stats[i].Begin=new Date(stats[i].Begin),stats[i].End=new Date(stats[i].End);Chart.defaults.global.responsive=!0,Chart.defaults.global.pointDot=!1,Chart.defaults.global.pointDotRadius=2,sector(),country(),employers(),durations(),gratification(),declared(),grades("Midterm"),grades("Final"),surveys("midterm")})})}),String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)}}();