!function(){function declared(){var ms=[],i=0;stats.forEach(function(s){d=new Date(s.Creation),d.setUTCDate(d.getUTCDate()>15?15:1);d.getMonth();ms.push(d.getYear()-100+"-"+d.getUTCMonth()+"-"+d.getUTCDate())}),ms.sort();var toShift=ms[0].endsWith("-15");if(toShift){var x=ms[0].substring(0,ms[0].length-3)+"-1";ms.unshift(x)}var labels=[],count=[],i=0;for(ms.forEach(function(m){0==labels.length?(labels.push(m),count[i++]=1):labels[i-1]==m?count[i-1]++:(labels[i]=m,count[i]=count[i-1]+1,i++)}),toShift&&count.unshift(0),i=0;i<count.length;i++)count[i]=Math.round(count[i]/stats.length*100);var xx=[];labels.forEach(function(l){var buf=l.split("-");xx.push(months[buf[1]]+" "+buf[0])});{var atLab=$("#conventions").get(0).getContext("2d"),data={labels:ddply(xx),datasets:[line(count)]};new Chart(atLab).Line(data,{pointDotRadius:2,tooltipTemplate:"<%= value %>",scaleOverride:!0,scaleSteps:6,scaleStepWidth:20})}}function ddply(arr){for(var res=[arr[0]],i=1;i<arr.length;i++)res[i]=arr[i]==arr[i-1]?"":arr[i];return res}function durations(){var begin=new Date;begin.setMonth(1),begin.setDate(1);var end=new Date;end.setMonth(10),end.setDate(31);for(var labels=[],cur=new Date(begin.getTime()),ins=[];cur.getTime()<end.getTime();)labels.push(months[cur.getMonth()]),cur.setMonth(cur.getMonth()+1),ins.push(0);stats.forEach(function(s){for(var i=0,cur=new Date(begin.getTime());cur.getTime()<end.getTime();)s.Begin.getTime()<=cur.getTime()&&s.End.getTime()>=cur.getTime()&&ins[i]++,cur.setMonth(cur.getMonth()+1),i++});{var atLab=$("#periods").get(0).getContext("2d"),data={labels:ddply(labels),datasets:[line(ins)]};new Chart(atLab).Line(data,{pointDotRadius:2,tooltipTemplate:"<%= value %>",scaleOverride:!0,scaleSteps:6,scaleStepWidth:20})}}function gratification(filter){$("li.gratification").removeClass("active"),filter?$("li.gratification."+filter).addClass("active"):$("li.gratification.all").addClass("active");var si=[],master=[],lab=[],company=[],fr=[],out=[],all=0;if(stats.forEach(function(s){all+=s.Gratification,"SI"==s.Promotion?si.push(s.Gratification):master.push(s.Gratification),s.Lab?lab.push(s.Gratification):company.push(s.Gratification),s.ForeignCountry?out.push(s.Gratification):fr.push(s.Gratification)}),filter){var a,b;"promotion"==filter?(a=Math.round(avg(si)),b=Math.round(avg(master))):"sector"==filter?(a=Math.round(avg(lab)),b=Math.round(avg(company))):"country"==filter&&(a=Math.round(avg(fr)),b=Math.round(avg(out))),$("#how-much").html(a+"€ vs. "+b+"€")}else $("#how-much").html(Math.round(all/stats.length)+"€")}function avg(values){var sum=0,nb=0;return values.forEach(function(v){sum+=v,nb++}),sum/nb}function employers(){var c2={};stats.forEach(function(s){s.Cpy.WWW?c2[s.Cpy.WWW]="<a href='"+s.Cpy.WWW+"'>"+s.Cpy.Name+"</a>":c2[s.Cpy.Name]=s.Cpy.Name});var c3=[];Object.keys(c2).forEach(function(k){c3.push(c2[k])}),$("#employers").html(c3.join("; "))}function country(filter){$("li.country").removeClass("active"),filter?$("li.country."+filter).addClass("active"):$("li.country.all").addClass("active"),qty=[0,0],stats.forEach(function(s){(void 0==filter||s.Promotion==filter)&&(qty[s.ForeignCountry?1:0]+=1)});var g=$("#canvas-country").get(0).getContext("2d");data=[{value:qty[0],label:"France",color:"#F7464A",highlight:"#FF5A5E"},{value:qty[1],label:"Foreign Country",color:"#FDB45C",highlight:"#FFC870"}],pieCountry?(pieCountry.segments[0].value=qty[0],pieCountry.segments[1].value=qty[1],pieCountry.update()):pieCountry=new Chart(g).Pie(data)}function sector(filter){$("li.sector").removeClass("active"),filter?$("li.sector."+filter).addClass("active"):$("li.sector.all").addClass("active"),qty=[0,0],stats.forEach(function(s){(void 0==filter||s.Promotion==filter)&&(qty[s.Lab?1:0]+=1)});var g=$("#canvas-sector").get(0).getContext("2d"),data=[{value:qty[0],label:"Company",color:"#949FB1",highlight:"#A8B3C5"},{value:qty[1],label:"Lab",color:"#4D5360",highlight:"#616774"}];pieSector?(pieSector.segments[0].value=qty[0],pieSector.segments[1].value=qty[1],pieSector.update()):pieSector=new Chart(g).Pie(data)}function line(dta){return{label:"Pick up date",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:dta}}var stats,allMajors,pieCountry,pieSector,months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];$(document).ready(function(){waitingBlock=$("#cnt").clone().html(),statistics(function(m){stats=m,majors(function(m){allMajors=m,allMajors.unshift("ALL"),allMajors.push("n/a")});for(var i=0;i<stats.length;i++)""!=stats[i].Major&&stats[i].Major||(stats[i].Major="n/a"),stats[i].Promotion=stats[i].Promotion.indexOf("si")>=0?"SI":"master",stats[i].Gratification>1e4&&(stats[i].Gratification/=100),stats[i].Begin=new Date(stats[i].Begin),stats[i].End=new Date(stats[i].End);Chart.defaults.global.responsive=!0,Chart.defaults.global.pointDot=!1,Chart.defaults.global.pointDotRadius=2,sector(),country(),employers(),durations(),gratification(),declared()})}),String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)}}();