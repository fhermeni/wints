!function(){function twoD(d){return 9>=d?"0"+d:d}Handlebars.getTemplate=function(name){return(void 0===Handlebars.templates||void 0===Handlebars.templates[name])&&$.ajax({url:"/static/tpls/"+name+".handlebars",success:function(data){void 0===Handlebars.templates&&(Handlebars.templates={}),Handlebars.templates[name]=Handlebars.compile(data)},async:!1}),Handlebars.templates[name]},Handlebars.registerHelper("fullname",function(p){return p.Firstname+" "+p.Lastname}),Handlebars.registerHelper("prettyFullname",function(p){var fn=p.Firstname,ln=p.Lastname;return fn.charAt(0).toUpperCase()+fn.substring(1)+" "+ln.charAt(0).toUpperCase()+ln.substring(1)}),Handlebars.registerHelper("shortFullname",function(p){var fn=p.Firstname+" "+p.Lastname;return fn.length>20&&(fn=p.Firstname[0]+". "+p.Lastname),fn}),Handlebars.registerHelper("abbrvFullname",function(p){return p.Firstname[0].toUpperCase()+". "+p.Lastname}),Handlebars.registerHelper("shortProm",function(p){return 0==p.indexOf("master")&&(p="ma. "+p.substring(p.lastIndexOf(" "))),p}),Handlebars.registerHelper("len",function(a){return a.length}),Handlebars.registerHelper("company",function(c){return c.WWW&&""!=c.WWW?new Handlebars.SafeString("<a target='_blank' href='"+c.WWW+"'>"+c.Name+"</a>"):c.Name}),Handlebars.registerHelper("shortCompany",function(c){return n=c.Company,n.length>30&&(n=n.substring(0,27)+"..."),""!=c.CompanyWWW?new Handlebars.SafeString("<a target='_blank' href='"+c.CompanyWWW+"'>"+n+"</a>"):n}),Handlebars.registerHelper("date",function(d){return moment(d).format("D MMM YYYY")}),Handlebars.registerHelper("datetime",function(d){return moment(d).format("DD/MM/YY HH:mm")}),Handlebars.registerHelper("longdatetime",function(d){return moment(d).format("D MMM YY HH:mm")}),Handlebars.registerHelper("rawFullname",function(p){var fn=p.Firstname+" "+p.Lastname;for(i=fn.length;i<40;i++)fn+=" ";return fn}),Handlebars.registerHelper("raw",function(p){var fn=p;for(i=p.length;i<60;i++)fn+=" ";return fn}),Handlebars.registerHelper("majorOptions",function(m){var b="";return m||(b+="<option selected>?</option>"),allMajors.forEach(function(o){var selected=m==o?" selected ":"";b+="<option value='"+o+"' "+selected+" >"+o+"</option>"}),new Handlebars.SafeString(b)}),Handlebars.registerHelper("userSelecter",function(users){var b="";return users.forEach(function(o){b+="<option value='"+o.Email+"'>"+o.Firstname+" "+o.Lastname+" ("+o.Tel+") </option>"}),new Handlebars.SafeString(b)}),Handlebars.registerHelper("jurySelecter",function(users){var b="";return users.forEach(function(o){b+="<option value='"+o.Email+"'>"+o.Firstname+" "+o.Lastname+" </option>"}),new Handlebars.SafeString(b)}),Handlebars.registerHelper("studentSelecter",function(users){var b="";return Object.keys(users).forEach(function(em){var i=users[em];b+="<option value='"+i.Student.Email+"'>"+i.Student.Firstname+" "+i.Student.Lastname+" ("+i.Major+") </option>"}),new Handlebars.SafeString(b)});var possiblePositions=["not available","sabbatical leave","looking for a job","pursuit of higher education","fixed term contract in the internship company","fixed term contract in another company","permanent contract in the internship company","permanent contract in another company","entrepreneurship"];Handlebars.registerHelper("nextPosition",function(pos){return new Handlebars.SafeString("<i>"+possiblePositions[pos]+"</i>")}),Handlebars.registerHelper("nextContact",function(c){return c&&0!=c.length?c:new Handlebars.SafeString("<i>not available</i>")}),Handlebars.registerHelper("positionSelector",function(pos){var b="";return possiblePositions.forEach(function(o,i){b+="<option value='"+i+"' "+(i==pos?" selected ":"")+">"+o+"</option>"}),new Handlebars.SafeString(b)}),Handlebars.registerHelper("roleOptions",function(m){var b="",i=1;return["tutor","major","admin","root"].forEach(function(k){var selected=i==m?" selected ":"";b+="<option value='"+i++ +"' "+selected+" >"+k+"</option>"}),new Handlebars.SafeString(b)}),Handlebars.registerHelper("slot",function(d){return d}),Handlebars.registerHelper("majors",function(emails){var majors={};return emails.forEach(function(e){e&&e.Major&&(majors[e.Major]=!0)}),Object.keys(majors).join(", ")}),Handlebars.registerHelper("commission",function(emails){var cnt=[];return emails.forEach(function(e){cnt.push(e?e.Firstname+" "+e.Lastname:"?")}),cnt.join(", ")}),Handlebars.registerHelper("offset",function(i,date){var offset=30*i*60*1e3,m=moment(date,"HH:mm"),from=new Date(m.toDate().getTime()+offset),to=new Date(from.getTime()+18e5),str=twoD(from.getHours())+":"+twoD(from.getMinutes())+" - "+twoD(to.getHours())+":"+twoD(to.getMinutes());return str}),Handlebars.registerHelper("committeeOptions",function(a,opts){return b="<option >?</option>",opts.forEach(function(o){var fn=o.Firstname+" "+o.Lastname,selected=a==o.Email?" selected ":"";b+="<option "+selected+" value='"+o.Email+"'>"+fn+"</option>"}),new Handlebars.SafeString(b)}),Handlebars.registerHelper("inc",function(d){return d+1}),Handlebars.registerHelper("slotEntry",function(e){if(e){var buf=e.P.Firstname+" "+e.P.Lastname+" ("+e.Major+")";return buf+=" <span onclick='switchVisibility(this)' class='glyphicon glyphicon-eye-"+(defenses.private[e.P.Email]?"close late":"open")+"'></span>",buf+=" <span onclick='switchVisio(this)' class='glyphicon "+(defenses.visio[e.P.Email]?"glyphicon-facetime-video":"glyphicon-user")+"'></span>",new Handlebars.SafeString(buf)}return"Break"}),Handlebars.registerHelper("notEmptyJury",function(f){var empty=!0;return f.students.forEach(function(s){return void 0!=s?(empty=!1,!1):void 0}),empty}),Handlebars.registerHelper("slotMajor",function(e){if(e){var c=getConvention(e);return c.Stu.Major}return"Break"}),Handlebars.registerHelper("slotDate",function(s){var m=moment(s,"DD/MM/YYYY HH:mm");return m.lang("fr"),m.format("dddd D MMMM")}),Handlebars.registerHelper("shortSlotEntry",function(s){if(e){var c=getConvention(e),fn=c.Stu.P.Firstname+" "+c.Stu.P.Lastname;return fn.length>30&&(fn=fn.substring(0,27)+"..."),fn+" ("+s.Major+")"}return"Break"}),Handlebars.registerHelper("shortKind",function(r){return r.Kind.substring(0,3)}),Handlebars.registerHelper("reportStatus",function(r){var passed=new Date(Date.parse(r.Deadline)).getTime()+864e5<(new Date).getTime(),style="btn-link";return passed&&-2==r.Grade?style="btn-warning":-1==r.Grade?style="btn-primary":r.ToGrade&&r.Grade>=0&&r.Grade<10?style="btn-danger":(!r.ToGrade&&r.Grade>=0||r.Grade>=10)&&(style="btn-success"),style}),Handlebars.registerHelper("gradeAnnotation",function(r){var passed=new Date(Date.parse(r.Deadline)).getTime()+864e5<(new Date).getTime();return!passed&&!r.toGrade>=-1?-10:r.Grade}),Handlebars.registerHelper("surveyStatus",function(s){var passed=new Date(Date.parse(s.Deadline)).getTime()+864e5<(new Date).getTime(),style="badge-info";return passed&&s.Answers=={}?style="badge-danger":Object.keys(s.Answers).length>0&&(style="badge-success"),style}),Handlebars.registerHelper("reportGrade",function(r){return r.ToGrade?-2==r.Grade?"-":-1==r.Grade?"?":r.Grade:new Handlebars.SafeString("<i title='no grade needed'>n/a</i>")}),Handlebars.registerHelper("gradeInput",function(r){return!r.ToGrade||r.Grade<0?"":r.Grade}),Handlebars.registerHelper("studentGrade",function(r){var passed=new Date(r.Deadline).getTime()+864e5<(new Date).getTime();return r.Uploaded?r.ToGrade?-1==r.Grade?"?":r.Grade:-1==r.Grade?"(waiting for the review)":"n/a":0==r.Grade?r.Grade:passed?"deadline passed. Hurry!":""}),Handlebars.registerHelper("URIemails",function(students){var l=[];return students.forEach(function(s){s&&s.P&&l.push(s.P.Email)}),encodeURI(l.join(","))}),Handlebars.registerHelper("student",function(g){if(!g||0==g.length)return"break";var buf=g.P.Firstname+" "+g.P.Lastname;defenses.private[g.P.Email]&&(buf+=" <span class='glyphicon glyphicon-eye-close'></span>"),defenses.visio[g.P.Email]&&(buf+=" <span class='glyphicon glyphicon-facetime-video'></span>");var c=getConvention(g.P.Email);return c.SupReport.IsIn||(buf+=" <span class='glyphicon glyphicon-file alert-danger'></span>"),new Handlebars.SafeString(buf)}),Handlebars.registerHelper("longDate",function(d){var m=moment(d,"DD/MM/YYYY");return m.lang("fr"),m.format("dddd D MMMM")})}();